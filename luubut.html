<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L∆∞u B√∫t C·ªßa Khang</title>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700;800&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #141414;
            --bg-card: rgba(255, 255, 255, 0.02);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-tertiary: rgba(255, 255, 255, 0.4);
            --accent-primary: #d4a373;
            --accent-secondary: #9d7c5e;
            --border-subtle: rgba(255, 255, 255, 0.08);
            --shadow-ambient: rgba(0, 0, 0, 0.5);
        }

        [data-theme="light"] {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-card: rgba(0, 0, 0, 0.02);
            --text-primary: #1a1a1a;
            --text-secondary: rgba(0, 0, 0, 0.7);
            --text-tertiary: rgba(0, 0, 0, 0.4);
            --border-subtle: rgba(0, 0, 0, 0.08);
            --shadow-ambient: rgba(0, 0, 0, 0.1);
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
            position: relative;
            transition: background 0.3s ease, color 0.3s ease;
        }

        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            top: 30px;
            right: 30px;
            z-index: 1000;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 50px;
            padding: 8px;
            display: flex;
            gap: 5px;
            backdrop-filter: blur(20px);
            box-shadow: 0 4px 20px var(--shadow-ambient);
        }

        .theme-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            background: transparent;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-btn.active {
            background: var(--accent-primary);
            transform: scale(1.1);
        }

        .theme-btn:hover {
            background: rgba(212, 163, 115, 0.2);
        }

        /* Particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: var(--accent-primary);
            border-radius: 50%;
            opacity: 0;
            animation: float 15s infinite ease-in-out;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0) translateX(0);
                opacity: 0;
            }
            10% {
                opacity: 0.3;
            }
            50% {
                transform: translateY(-100vh) translateX(50px);
                opacity: 0.6;
            }
            90% {
                opacity: 0.2;
            }
        }

        .page {
            display: none;
            position: relative;
            z-index: 10;
        }

        .page.active {
            display: block;
            animation: pageTransition 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes pageTransition {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Hero Section */
        .hero-section {
            position: relative;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            overflow: hidden;
        }

        .hero-bg {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url('https://scontent.fhan5-3.fna.fbcdn.net/v/t39.30808-6/524599138_1307950401333036_8534844615694569286_n.jpg?_nc_cat=105&ccb=1-7&_nc_sid=127cfc&_nc_eui2=AeHkg1Y-gZqmL5XZ3MydVFphVzGpMXZPTKRXMakxdk9MpJbuLiSHqYAs97Gq8uiAGXK02icqSe2I-vPQgE6Pb8DR&_nc_ohc=_ANoNWU0Z3MQ7kNvwGoPNXC&_nc_oc=Adnqz76g7Ka-93LsfrZ5p7BsevRov_XBzxs2_si-2Ihwzch8jRRkC8Ihqph0Qf8IJJMfBS5LIo9K7gm5_1VksU9W&_nc_zt=23&_nc_ht=scontent.fhan5-3.fna&_nc_gid=qxOAaI13p2tdlTeh7HxY7Q&oh=00_AfnCQJzfjxC_KZoQYueZgerB93osMwVawSfDACJDaavGMw&oe=6945DEBC');
            background-size: cover;
            background-position: center;
            filter: brightness(0.3) saturate(0.8);
            z-index: 0;
            transition: filter 0.3s ease;
        }

        [data-theme="light"] .hero-bg {
            filter: brightness(0.7) saturate(1.2);
        }

        .hero-bg::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 50% 50%, transparent 0%, rgba(10, 10, 10, 0.6) 80%, var(--bg-primary) 100%);
        }

        .hero-content {
            position: relative;
            z-index: 10;
            max-width: 900px;
            text-align: center;
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 24px;
            background: rgba(212, 163, 115, 0.08);
            border: 1px solid rgba(212, 163, 115, 0.2);
            border-radius: 100px;
            font-size: 0.85em;
            font-weight: 500;
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-bottom: 40px;
            backdrop-filter: blur(20px);
            animation: fadeInScale 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.1s both;
        }

        .hero-badge::before {
            content: '‚ú¶';
            color: var(--accent-primary);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        .hero-title {
            font-family: 'Crimson Pro', serif;
            font-size: clamp(3em, 8vw, 5.5em);
            font-weight: 800;
            margin-bottom: 30px;
            line-height: 1.1;
            letter-spacing: -0.02em;
            min-height: 1.2em;
            animation: fadeInScale 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.3s both;
        }

        .typing-text {
            background: linear-gradient(135deg, #ffffff 0%, rgba(255,255,255,0.6) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: inline-block;
        }

        [data-theme="light"] .typing-text {
            background: linear-gradient(135deg, #1a1a1a 0%, rgba(26,26,26,0.6) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .typing-cursor {
            display: inline-block;
            width: 3px;
            height: 0.8em;
            background: var(--accent-primary);
            margin-left: 5px;
            animation: blink 1s infinite;
            vertical-align: middle;
        }

        @keyframes blink {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0; }
        }

        .hero-divider {
            width: 60px;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent-primary), transparent);
            margin: 30px auto;
            animation: expandWidth 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.5s both;
        }

        @keyframes expandWidth {
            from { width: 0; }
            to { width: 60px; }
        }

        .hero-credits {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 40px;
            font-size: 0.9em;
            color: var(--text-tertiary);
            animation: fadeInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.6s both;
            flex-wrap: wrap;
        }

        .hero-credits a {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--text-secondary);
            text-decoration: none;
            padding: 6px 14px;
            border-radius: 20px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid transparent;
        }

        .hero-credits a:hover {
            color: var(--accent-primary);
            background: rgba(212, 163, 115, 0.08);
            border-color: rgba(212, 163, 115, 0.2);
            transform: translateY(-2px);
        }

        .hero-description {
            font-size: clamp(1em, 2vw, 1.2em);
            line-height: 1.8;
            color: var(--text-secondary);
            margin-bottom: 50px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            animation: fadeInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.7s both;
        }

        .hero-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            animation: fadeInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.9s both;
        }

        /* Buttons */
        .btn {
            position: relative;
            padding: 18px 40px;
            border: none;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            overflow: hidden;
            font-family: 'DM Sans', sans-serif;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.15);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 400px;
            height: 400px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: var(--bg-primary);
            box-shadow: 0 8px 30px rgba(212, 163, 115, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(212, 163, 115, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            border: 1px solid var(--border-subtle);
            backdrop-filter: blur(20px);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(212, 163, 115, 0.3);
            transform: translateY(-3px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Content Sections */
        .content-section {
            min-height: 100vh;
            padding: 80px 20px;
            background: var(--bg-primary);
            position: relative;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            color: var(--text-secondary);
            font-size: 0.95em;
            margin-bottom: 50px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 8px;
        }

        .back-link:hover {
            color: var(--accent-primary);
            background: rgba(212, 163, 115, 0.05);
            transform: translateX(-5px);
        }

        .section-title {
            font-family: 'Crimson Pro', serif;
            font-size: clamp(2.5em, 6vw, 3.5em);
            font-weight: 800;
            margin-bottom: 60px;
            text-align: center;
            letter-spacing: -0.02em;
            animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .section-subtitle {
            text-align: center;
            color: var(--text-secondary);
            font-size: 1.1em;
            margin-top: -40px;
            margin-bottom: 50px;
            animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1) 0.1s both;
        }

        /* Skeleton Loading */
        .skeleton {
            background: linear-gradient(90deg, var(--bg-card) 25%, rgba(212, 163, 115, 0.05) 50%, var(--bg-card) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s ease-in-out infinite;
            border-radius: 12px;
        }

        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .skeleton-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
        }

        .skeleton-header {
            display: flex;
            gap: 16px;
            margin-bottom: 25px;
        }

        .skeleton-avatar {
            width: 56px;
            height: 56px;
            border-radius: 50%;
        }

        .skeleton-info {
            flex: 1;
        }

        .skeleton-name {
            height: 20px;
            width: 150px;
            margin-bottom: 10px;
        }

        .skeleton-date {
            height: 16px;
            width: 100px;
        }

        .skeleton-message {
            height: 16px;
            margin-bottom: 12px;
        }

        /* Form Card */
        .form-card {
            background: var(--bg-card);
            backdrop-filter: blur(40px);
            border: 1px solid var(--border-subtle);
            border-radius: 24px;
            padding: 50px;
            box-shadow: 0 20px 60px var(--shadow-ambient);
            animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1) 0.2s both;
            position: relative;
            overflow: hidden;
        }

        .form-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--accent-primary), transparent);
            opacity: 0.5;
        }

        .form-group {
            margin-bottom: 30px;
        }

        .form-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.95em;
            letter-spacing: 0.5px;
        }

        .char-count {
            font-size: 0.85em;
            color: var(--text-tertiary);
            font-weight: 500;
            transition: color 0.3s;
        }

        .char-count.warning {
            color: #f59e0b;
        }

        .char-count.danger {
            color: #ef4444;
        }

        .form-input,
        .form-textarea {
            width: 100%;
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1em;
            font-family: inherit;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 4px rgba(212, 163, 115, 0.1);
        }

        .form-input::placeholder,
        .form-textarea::placeholder {
            color: var(--text-tertiary);
        }

        .form-textarea {
            min-height: 200px;
            resize: vertical;
            line-height: 1.7;
        }

        .submit-btn {
            width: 100%;
            margin-top: 20px;
        }

        /* Letter Cards */
        .letter-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            animation: fadeInUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(40px);
            box-shadow: 0 10px 40px var(--shadow-ambient);
            position: relative;
            overflow: hidden;
        }

        .letter-card::before {
            content: '‚ùù';
            position: absolute;
            top: 20px;
            left: 30px;
            font-size: 80px;
            font-family: 'Crimson Pro', serif;
            color: var(--accent-primary);
            opacity: 0.08;
            line-height: 1;
        }

        .letter-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 25px;
            padding-bottom: 25px;
            border-bottom: 1px solid var(--border-subtle);
            position: relative;
            z-index: 1;
        }

        .letter-avatar {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.5em;
            font-family: 'Crimson Pro', serif;
            box-shadow: 0 4px 20px rgba(212, 163, 115, 0.3);
        }

        .letter-info h3 {
            font-family: 'Crimson Pro', serif;
            font-size: 1.3em;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .letter-date {
            font-size: 0.9em;
            color: var(--text-tertiary);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .letter-message {
            font-size: 1.05em;
            line-height: 1.8;
            color: var(--text-secondary);
            white-space: pre-wrap;
            position: relative;
            z-index: 1;
            margin-bottom: 20px;
        }

        /* Reactions */
        .letter-reactions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .reaction-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border-subtle);
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9em;
        }

        .reaction-btn:hover {
            background: rgba(212, 163, 115, 0.1);
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }

        .reaction-btn.active {
            background: rgba(212, 163, 115, 0.2);
            border-color: var(--accent-primary);
        }

        /* Comments */
        .comments-section {
            border-top: 1px solid var(--border-subtle);
            padding-top: 20px;
            margin-top: 20px;
        }

        .comments-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .comments-title {
            font-weight: 600;
            font-size: 0.95em;
        }

        .toggle-comments {
            background: none;
            border: none;
            color: var(--accent-primary);
            cursor: pointer;
            font-size: 0.9em;
            padding: 5px 10px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .toggle-comments:hover {
            background: rgba(212, 163, 115, 0.1);
        }

        .comments-list {
            margin-bottom: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .comment {
            padding: 12px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .comment-author {
            font-weight: 600;
            font-size: 0.9em;
            margin-bottom: 5px;
            color: var(--accent-primary);
        }

        .comment-text {
            font-size: 0.9em;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .comment-input-group {
            display: flex;
            gap: 10px;
        }

        .comment-input {
            flex: 1;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 0.9em;
            font-family: inherit;
        }

        .comment-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .comment-btn {
            padding: 10px 20px;
            background: var(--accent-primary);
            border: none;
            border-radius: 10px;
            color: var(--bg-primary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .comment-btn:hover {
            background: var(--accent-secondary);
            transform: translateY(-2px);
        }

        /* Social Share */
        .letter-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 10px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .action-btn:hover {
            background: rgba(212, 163, 115, 0.1);
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }

        /* QR Code Modal */
        .qr-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            padding: 40px;
            border-radius: 24px;
            text-align: center;
            z-index: 999;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            max-width: 400px;
            width: 90%;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.8);
            display: none;
        }

        .qr-modal.show {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
            display: block;
        }

        .qr-modal h3 {
            font-family: 'Crimson Pro', serif;
            font-size: 1.8em;
            margin-bottom: 20px;
        }

        #qrcode {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 12px;
        }

        .qr-close {
            margin-top: 20px;
        }

        /* Modal Overlay */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            display: none;
            z-index: 998;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.show {
            display: block;
        }

        /* Toast */
        .toast {
            position: fixed;
            top: 30px;
            right: 30px;
            padding: 18px 28px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.5);
            z-index: 9999;
            animation: slideInRight 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 400px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .toast.success {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .toast.error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .toast.info {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        }

        .toast.slideOut {
            animation: slideOutRight 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Utility Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Instagram Story Card */
        .instagram-card {
            position: relative;
            width: 100%;
            max-width: 400px;
            aspect-ratio: 9/16;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 20px;
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .instagram-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('https://scontent.fhan5-3.fna.fbcdn.net/v/t39.30808-6/524599138_1307950401333036_8534844615694569286_n.jpg?_nc_cat=105&ccb=1-7&_nc_sid=127cfc&_nc_eui2=AeHkg1Y-gZqmL5XZ3MydVFphVzGpMXZPTKRXMakxdk9MpJbuLiSHqYAs97Gq8uiAGXK02icqSe2I-vPQgE6Pb8DR&_nc_ohc=_ANoNWU0Z3MQ7kNvwGoPNXC&_nc_oc=Adnqz76g7Ka-93LsfrZ5p7BsevRov_XBzxs2_si-2Ihwzch8jRRkC8Ihqph0Qf8IJJMfBS5LIo9K7gm5_1VksU9W&_nc_zt=23&_nc_ht=scontent.fhan5-3.fna&_nc_gid=qxOAaI13p2tdlTeh7HxY7Q&oh=00_AfnCQJzfjxC_KZoQYueZgerB93osMwVawSfDACJDaavGMw&oe=6945DEBC');
            background-size: cover;
            background-position: center;
            opacity: 0.3;
            filter: blur(30px);
        }

        .instagram-card-content {
            position: relative;
            z-index: 1;
        }

        .instagram-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .instagram-title {
            font-family: 'Crimson Pro', serif;
            font-size: 2.5em;
            font-weight: 800;
            color: white;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .instagram-subtitle {
            color: rgba(255,255,255,0.9);
            font-size: 1em;
        }

        .instagram-message-box {
            background: rgba(255,255,255,0.95);
            border-radius: 16px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .instagram-author {
            font-weight: 700;
            font-size: 1.1em;
            color: #333;
            margin-bottom: 10px;
        }

        .instagram-text {
            color: #555;
            line-height: 1.6;
            font-size: 0.95em;
        }

        .instagram-footer {
            text-align: center;
            color: white;
        }

        .instagram-qr {
            background: white;
            padding: 15px;
            border-radius: 16px;
            display: inline-block;
            margin-bottom: 15px;
        }

        .instagram-url {
            font-size: 0.85em;
            opacity: 0.9;
        }

        /* Instagram Modal */
        .instagram-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            padding: 40px;
            border-radius: 24px;
            z-index: 999;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.8);
            display: none;
        }

        .instagram-modal.show {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
            display: block;
        }

        .instagram-modal h3 {
            font-family: 'Crimson Pro', serif;
            font-size: 1.8em;
            margin-bottom: 20px;
            text-align: center;
        }

        .instagram-preview {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }

        .instagram-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .instagram-actions button {
            flex: 1;
        }
        @media (max-width: 768px) {
            .hero-title {
                font-size: 3em;
            }

            .section-title {
                font-size: 2.2em;
            }

            .form-card,
            .letter-card {
                padding: 30px;
            }

            .hero-buttons,
            .letter-actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .toast {
                right: 15px;
                left: 15px;
                max-width: calc(100% - 30px);
            }

            .hero-credits {
                flex-direction: column;
                gap: 10px;
            }

            .theme-toggle {
                top: 20px;
                right: 20px;
            }
        }

        @media (max-width: 480px) {
            .hero-section {
                padding: 30px 15px;
            }

            .content-section {
                padding: 60px 15px;
            }

            .form-card,
            .letter-card {
                padding: 20px;
            }

            .btn {
                padding: 14px 24px;
                font-size: 0.95em;
            }

            .hero-badge {
                font-size: 0.75em;
                padding: 8px 16px;
            }

            .letter-card::before {
                font-size: 60px;
                top: 15px;
                left: 20px;
            }

            .reaction-btn,
            .action-btn {
                font-size: 0.85em;
                padding: 8px 12px;
            }

            .theme-toggle {
                padding: 6px;
            }

            .theme-btn {
                width: 36px;
                height: 36px;
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <!-- Theme Toggle -->
    <div class="theme-toggle">
        <button class="theme-btn active" id="darkBtn" onclick="setTheme('dark')" aria-label="Ch·∫ø ƒë·ªô t·ªëi">
            üåô
        </button>
        <button class="theme-btn" id="lightBtn" onclick="setTheme('light')" aria-label="Ch·∫ø ƒë·ªô s√°ng">
            ‚òÄÔ∏è
        </button>
    </div>

    <!-- Animated Particles -->
    <div class="particles" id="particles"></div>

    <!-- Modal Overlay -->
    <div class="modal-overlay" id="overlay"></div>

    <!-- Instagram Modal -->
    <div class="instagram-modal" id="instagramModal">
        <h3>üì∏ Chia s·∫ª l√™n Instagram</h3>
        <p style="color: var(--text-secondary); text-align: center; margin-bottom: 20px;">
            T·∫£i ·∫£nh xu·ªëng v√† chia s·∫ª l√™n Instagram Stories
        </p>
        <div class="instagram-preview" id="instagramPreview"></div>
        <div class="instagram-actions">
            <button class="btn btn-secondary" onclick="closeInstagramModal()">ƒê√≥ng</button>
            <button class="btn btn-primary" onclick="downloadInstagramStory()">‚¨áÔ∏è T·∫£i xu·ªëng</button>
        </div>
    </div>

    <!-- QR Code Modal -->
    <div class="qr-modal" id="qrModal">
        <h3>üì± Qu√©t m√£ QR</h3>
        <p style="color: var(--text-secondary); margin-bottom: 20px;">Chia s·∫ª trang web n√†y v·ªõi b·∫°n b√®</p>
        <div id="qrcode"></div>
        <button class="btn btn-primary qr-close" onclick="closeQRModal()">ƒê√≥ng</button>
    </div>

    <!-- Home Page -->
    <div class="page active" id="homePage">
        <section class="hero-section">
            <div class="hero-bg"></div>
            <div class="hero-content">
                <div class="hero-badge">L∆∞u b√∫t c·ªßa khang hehe</div>
                <h1 class="hero-title">
                    <span class="typing-text" id="typingText"></span>
                    <span class="typing-cursor"></span>
                </h1>
                <div class="hero-divider"></div>
                <div class="hero-credits">
                    <span>T·∫°o b·ªüi @zandereddddddddddgs</span>
                    <span>‚Ä¢</span>
                    <a href="https://drive.google.com/drive/folders/1lxE2973-9JFyOxg9IoSReMfsQBO6gjL7" target="_blank" rel="noopener noreferrer">
                        üìÇ Open Source
                    </a>
                </div>
                <p class="hero-description">
                    Ch√†o m·ªçi ng∆∞·ªùi, ƒë√¢y l√† n∆°i l∆∞u gi·ªØ nh·ªØng k·ª∑ ni·ªám ƒë·∫πp. 
                    Trang web n√†y ƒë·∫∑c bi·ªát h∆°n m·ªôt ch√∫t, v√¨ ƒë∆∞·ª£c t·ª± tay l√†m thay v√¨ d√πng Google Form.
                    <br><br>
                    D√π sau n√†y c√≥ ra sao, s·ª± hi·ªán di·ªán c·ªßa m·ªçi ng∆∞·ªùi ·ªü hi·ªán t·∫°i ƒë·ªÅu l√† ƒëi·ªÅu ƒë√°ng qu√Ω.
                </p>
                <div class="hero-buttons">
                    <button class="btn btn-primary" onclick="showPage('write')">
                        ‚úçÔ∏è B·∫Øt ƒë·∫ßu vi·∫øt
                    </button>
                    <button class="btn btn-secondary" onclick="showReadPage()">
                        üìñ ƒê·ªçc l·∫°i th∆∞
                    </button>
                    <button class="btn btn-secondary" onclick="showQRModal()">
                        üì± Chia s·∫ª QR
                    </button>
                </div>
            </div>
        </section>
    </div>

    <!-- Write Page -->
    <div class="page" id="writePage">
        <section class="content-section">
            <div class="container">
                <a class="back-link" onclick="showPage('home')">
                    ‚Üê Quay l·∫°i
                </a>
                <h2 class="section-title">Vi·∫øt l∆∞u b√∫t</h2>
                <p class="section-subtitle">H√£y ƒë·ªÉ l·∫°i nh·ªØng d√≤ng chia s·∫ª ch√¢n th√†nh nh·∫•t c·ªßa b·∫°n</p>
                <div class="form-card">
                    <div class="form-group">
                        <label class="form-label" for="name">T√äN C·ª¶A B·∫†N</label>
                        <input type="text" id="name" class="form-input" placeholder="Nh·∫≠p t√™n ho·∫∑c nickname c·ªßa b·∫°n...">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="message">
                            <span>L·ªúI NH·∫ÆN</span>
                            <span class="char-count" id="charCount">0/500</span>
                        </label>
                        <textarea id="message" class="form-textarea" placeholder="Vi·∫øt nh·ªØng g√¨ b·∫°n mu·ªën chia s·∫ª..." maxlength="500" oninput="updateCharCount()"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="date">NG√ÄY</label>
                        <input type="text" id="date" class="form-input" readonly>
                    </div>
                    <button class="btn btn-primary submit-btn" onclick="showPreview()">
                        üëÅÔ∏è Xem tr∆∞·ªõc
                    </button>
                </div>
            </div>
        </section>
    </div>

    <!-- Preview Page -->
    <div class="page" id="previewPage">
        <section class="content-section">
            <div class="container">
                <a class="back-link" onclick="showPage('write')">
                    ‚Üê Ch·ªânh s·ª≠a l·∫°i
                </a>
                <h2 class="section-title">Xem tr∆∞·ªõc</h2>
                <p class="section-subtitle">Ki·ªÉm tra l·∫°i l·ªùi nh·∫Øn c·ªßa b·∫°n tr∆∞·ªõc khi g·ª≠i</p>
                <div id="previewCard"></div>
                <div style="display: flex; gap: 20px; margin-top: 30px; flex-wrap: wrap;">
                    <button class="btn btn-secondary" style="flex: 1;" onclick="showPage('write')">
                        ‚úèÔ∏è Ch·ªânh s·ª≠a
                    </button>
                    <button class="btn btn-primary" style="flex: 1;" onclick="handleSubmit()" id="confirmSubmitBtn">
                        ‚úì G·ª≠i ngay
                    </button>
                </div>
            </div>
        </section>
    </div>

    <!-- Thank You Page -->
    <div class="page" id="thankYouPage">
        <section class="content-section">
            <div style="text-align: center; max-width: 600px; margin: 0 auto; padding: 80px 20px;">
                <div style="font-size: 6em; margin-bottom: 40px;">üíù</div>
                <h2 style="font-family: 'Crimson Pro', serif; font-size: 3em; font-weight: 800; margin-bottom: 25px; letter-spacing: -0.02em;">
                    C·∫£m ∆°n b·∫°n r·∫•t nhi·ªÅu!
                </h2>
                <p style="font-size: 1.2em; line-height: 1.8; color: var(--text-secondary); margin-bottom: 50px;">
                    L·ªùi nh·∫Øn c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒëi th√†nh c√¥ng v√† ƒëang ƒë∆∞·ª£c l∆∞u gi·ªØ c·∫©n th·∫≠n. 
                    <br><br>C·∫£m ∆°n b·∫°n ƒë√£ d√†nh th·ªùi gian ƒë·ªÉ l∆∞u l·∫°i nh·ªØng k·ª∑ ni·ªám ƒë·∫πp n√†y.
                </p>
                <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="showPage('home')">
                        üè† Quay v·ªÅ trang ch·ªß
                    </button>
                    <button class="btn btn-secondary" onclick="openPlaylist()">
                        üéµ Playlist ch·ªØa l√†nh
                    </button>
                </div>
            </div>
        </section>
    </div>

    <!-- Read Page -->
    <div class="page" id="readPage">
        <section class="content-section">
            <div class="container">
                <a class="back-link" onclick="showPage('home')">
                    ‚Üê Quay l·∫°i
                </a>
                <h2 class="section-title">L·ªùi nh·∫Øn c·ªßa b·∫°n</h2>
                <p class="section-subtitle">Nh·ªØng d√≤ng ch·ªØ b·∫°n ƒë√£ ƒë·ªÉ l·∫°i</p>
                <div id="myLetterContainer"></div>
            </div>
        </section>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDEMOKEY-REPLACE-WITH-YOUR-KEY",
            authDomain: "your-project.firebaseapp.com",
            databaseURL: "https://your-project-default-rtdb.firebaseio.com",
            projectId: "your-project-id",
            storageBucket: "your-project.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef"
        };

        // Initialize Firebase
        let database;
        let isFirebaseEnabled = false;

        try {
            // Check if config is set up
            if (firebaseConfig.apiKey !== "AIzaSyDEMOKEY-REPLACE-WITH-YOUR-KEY") {
                firebase.initializeApp(firebaseConfig);
                database = firebase.database();
                isFirebaseEnabled = true;
                console.log('‚úÖ Firebase connected successfully');
            } else {
                console.log('‚ö†Ô∏è Firebase not configured - using localStorage fallback');
            }
        } catch (error) {
            console.error('Firebase initialization error:', error);
            console.log('‚ö†Ô∏è Using localStorage fallback');
        }

        // EmailJS Configuration
        const EMAILJS_PUBLIC_KEY = 'XsjEvv3tPNzklZgvl';
        const EMAILJS_SERVICE_ID = 'service_pzh0ulq';
        const EMAILJS_TEMPLATE_ID = 'template_cls7pwb';

        let emailJSConfigured = false;
        try {
            if (EMAILJS_PUBLIC_KEY !== 'YOUR_PUBLIC_KEY') {
                emailjs.init(EMAILJS_PUBLIC_KEY);
                emailJSConfigured = true;
            }
        } catch (error) {
            console.error('EmailJS init error:', error);
        }

        // Database Helper Functions
        async function saveEntryToDatabase(entry) {
            if (isFirebaseEnabled) {
                try {
                    await database.ref('entries/' + entry.id).set(entry);
                    return true;
                } catch (error) {
                    console.error('Firebase save error:', error);
                    return false;
                }
            } else {
                // Fallback to localStorage
                localStorage.setItem('myEntry', JSON.stringify(entry));
                return true;
            }
        }

        async function getMyEntry() {
            if (isFirebaseEnabled) {
                try {
                    const userId = getUserId();
                    const snapshot = await database.ref('entries').orderByChild('userId').equalTo(userId).once('value');
                    const entries = snapshot.val();
                    if (entries) {
                        const entryId = Object.keys(entries)[0];
                        return entries[entryId];
                    }
                    return null;
                } catch (error) {
                    console.error('Firebase get error:', error);
                    return null;
                }
            } else {
                const data = localStorage.getItem('myEntry');
                return data ? JSON.parse(data) : null;
            }
        }

        async function deleteMyEntry() {
            if (isFirebaseEnabled) {
                try {
                    const userId = getUserId();
                    const snapshot = await database.ref('entries').orderByChild('userId').equalTo(userId).once('value');
                    const entries = snapshot.val();
                    if (entries) {
                        const entryId = Object.keys(entries)[0];
                        await database.ref('entries/' + entryId).remove();
                    }
                    return true;
                } catch (error) {
                    console.error('Firebase delete error:', error);
                    return false;
                }
            } else {
                localStorage.removeItem('myEntry');
                return true;
            }
        }

        async function getAllEntries() {
            if (isFirebaseEnabled) {
                try {
                    const snapshot = await database.ref('entries').orderByChild('timestamp').once('value');
                    const entries = snapshot.val();
                    return entries ? Object.values(entries) : [];
                } catch (error) {
                    console.error('Firebase get all error:', error);
                    return [];
                }
            } else {
                const data = localStorage.getItem('myEntry');
                return data ? [JSON.parse(data)] : [];
            }
        }

        function getUserId() {
            let userId = localStorage.getItem('userId');
            if (!userId) {
                userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('userId', userId);
            }
            return userId;
        }

        // Reactions with Firebase
        async function saveReaction(entryId, type, count) {
            if (isFirebaseEnabled) {
                try {
                    await database.ref(`reactions/${entryId}/${type}`).set(count);
                } catch (error) {
                    console.error('Firebase reaction save error:', error);
                }
            } else {
                localStorage.setItem(`reaction_${entryId}_${type}`, count.toString());
            }
        }

        async function getReaction(entryId, type) {
            if (isFirebaseEnabled) {
                try {
                    const snapshot = await database.ref(`reactions/${entryId}/${type}`).once('value');
                    return snapshot.val() || 0;
                } catch (error) {
                    console.error('Firebase reaction get error:', error);
                    return 0;
                }
            } else {
                return parseInt(localStorage.getItem(`reaction_${entryId}_${type}`) || '0');
            }
        }

        // Comments with Firebase
        async function saveComment(entryId, comment) {
            if (isFirebaseEnabled) {
                try {
                    const commentRef = database.ref(`comments/${entryId}`).push();
                    await commentRef.set(comment);
                } catch (error) {
                    console.error('Firebase comment save error:', error);
                }
            } else {
                const comments = JSON.parse(localStorage.getItem(`comments_${entryId}`) || '[]');
                comments.push(comment);
                localStorage.setItem(`comments_${entryId}`, JSON.stringify(comments));
            }
        }

        async function getComments(entryId) {
            if (isFirebaseEnabled) {
                try {
                    const snapshot = await database.ref(`comments/${entryId}`).once('value');
                    const comments = snapshot.val();
                    return comments ? Object.values(comments) : [];
                } catch (error) {
                    console.error('Firebase comment get error:', error);
                    return [];
                }
            } else {
                return JSON.parse(localStorage.getItem(`comments_${entryId}`) || '[]');
            }
        }
        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            
            document.getElementById('darkBtn').classList.toggle('active', theme === 'dark');
            document.getElementById('lightBtn').classList.toggle('active', theme === 'light');
        }

        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            setTheme(savedTheme);
        }

        // Typing Animation
        function typeWriter(text, element, speed = 100) {
            let i = 0;
            element.textContent = '';
            
            function type() {
                if (i < text.length) {
                    element.textContent += text.charAt(i);
                    i++;
                    setTimeout(type, speed);
                }
            }
            
            type();
        }

        // Initialize particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = window.innerWidth < 768 ? 15 : 30;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 15 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initTheme();
            createParticles();
            updateDate();
            
            // Start typing animation
            setTimeout(() => {
                typeWriter('L∆∞u B√∫t C·ªßa Khang', document.getElementById('typingText'), 80);
            }, 500);
        });

        // Toast notification
        function showToast(message, type = 'success') {
            const existingToasts = document.querySelectorAll('.toast');
            existingToasts.forEach(toast => toast.remove());

            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icon = type === 'success' ? '‚úì' : type === 'error' ? '‚úï' : '‚Ñπ';
            toast.innerHTML = `<span style="font-size: 1.2em;">${icon}</span><span>${message}</span>`;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('slideOut');
                setTimeout(() => toast.remove(), 400);
            }, 3500);
        }

        // Confetti Effect
        function triggerConfetti() {
            const count = 200;
            const defaults = {
                origin: { y: 0.7 },
                zIndex: 9999
            };

            function fire(particleRatio, opts) {
                confetti(Object.assign({}, defaults, opts, {
                    particleCount: Math.floor(count * particleRatio)
                }));
            }

            fire(0.25, {
                spread: 26,
                startVelocity: 55,
            });

            fire(0.2, {
                spread: 60,
            });

            fire(0.35, {
                spread: 100,
                decay: 0.91,
                scalar: 0.8
            });

            fire(0.1, {
                spread: 120,
                startVelocity: 25,
                decay: 0.92,
                scalar: 1.2
            });

            fire(0.1, {
                spread: 120,
                startVelocity: 45,
            });
        }

        // Update date
        function updateDate() {
            const dateInput = document.getElementById('date');
            if (dateInput) {
                const today = new Date();
                dateInput.value = today.toLocaleDateString('vi-VN', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }
        }

        // Update character count
        function updateCharCount() {
            const message = document.getElementById('message').value;
            const count = document.getElementById('charCount');
            count.textContent = `${message.length}/500`;
            
            count.classList.remove('warning', 'danger');
            if (message.length > 450) {
                count.classList.add('warning');
            }
            if (message.length === 500) {
                count.classList.add('danger');
            }
        }

        // Page navigation
        function showPage(page) {
            document.querySelectorAll('.page').forEach(p => {
                p.classList.remove('active');
            });
            document.getElementById(page + 'Page').classList.add('active');
            
            if (page === 'write') {
                updateDate();
            }
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Show skeleton loading
        function showSkeletonLoading(container) {
            container.innerHTML = `
                <div class="skeleton-card">
                    <div class="skeleton-header">
                        <div class="skeleton skeleton-avatar"></div>
                        <div class="skeleton-info">
                            <div class="skeleton skeleton-name"></div>
                            <div class="skeleton skeleton-date"></div>
                        </div>
                    </div>
                    <div class="skeleton skeleton-message"></div>
                    <div class="skeleton skeleton-message" style="width: 90%;"></div>
                    <div class="skeleton skeleton-message" style="width: 95%;"></div>
                    <div class="skeleton skeleton-message" style="width: 85%;"></div>
                </div>
            `;
        }

        // Show preview
        function showPreview() {
            const name = document.getElementById('name').value.trim() || '·∫®n danh';
            const message = document.getElementById('message').value.trim();
            const date = document.getElementById('date').value;

            if (!message) {
                showToast('Vui l√≤ng nh·∫≠p l·ªùi nh·∫Øn tr∆∞·ªõc khi xem tr∆∞·ªõc!', 'error');
                document.getElementById('message').focus();
                return;
            }

            const previewCard = document.getElementById('previewCard');
            previewCard.innerHTML = createLetterCard(name, message, date, 'preview');

            showPage('preview');
        }

        // Create letter card HTML
        function createLetterCard(name, message, date, id = '') {
            return `
                <div class="letter-card">
                    <div class="letter-header">
                        <div class="letter-avatar">${name.charAt(0).toUpperCase()}</div>
                        <div class="letter-info">
                            <h3>${escapeHtml(name)}</h3>
                            <div class="letter-date">üìÖ ${date}</div>
                        </div>
                    </div>
                    <div class="letter-message">${escapeHtml(message)}</div>
                    
                    <div class="letter-reactions">
                        <button class="reaction-btn" onclick="toggleReaction('${id}', 'heart')">
                            ‚ù§Ô∏è <span id="heart-${id}">0</span>
                        </button>
                        <button class="reaction-btn" onclick="toggleReaction('${id}', 'like')">
                            üëç <span id="like-${id}">0</span>
                        </button>
                        <button class="reaction-btn" onclick="toggleReaction('${id}', 'star')">
                            ‚≠ê <span id="star-${id}">0</span>
                        </button>
                        <button class="reaction-btn" onclick="toggleReaction('${id}', 'smile')">
                            üòä <span id="smile-${id}">0</span>
                        </button>
                    </div>

                    <div class="comments-section">
                        <div class="comments-header">
                            <span class="comments-title">üí¨ B√¨nh lu·∫≠n (<span id="comment-count-${id}">0</span>)</span>
                            <button class="toggle-comments" onclick="toggleComments('${id}')">
                                Xem b√¨nh lu·∫≠n
                            </button>
                        </div>
                        <div class="comments-list" id="comments-${id}" style="display: none;"></div>
                        <div class="comment-input-group">
                            <input type="text" class="comment-input" id="comment-input-${id}" placeholder="Vi·∫øt b√¨nh lu·∫≠n...">
                            <button class="comment-btn" onclick="addComment('${id}')">G·ª≠i</button>
                        </div>
                    </div>

                    <div class="letter-actions">
                        <button class="action-btn" onclick="shareToFacebook()">
                            üìò Facebook
                        </button>
                        <button class="action-btn" onclick="shareToTwitter()">
                            üê¶ Twitter
                        </button>
                        <button class="action-btn" onclick="shareToInstagram('${id}')">
                            üì∏ Instagram
                        </button>
                        <button class="action-btn" onclick="editLetter()">
                            ‚úèÔ∏è Ch·ªânh s·ª≠a
                        </button>
                        <button class="action-btn" onclick="deleteLetter()">
                            üóëÔ∏è X√≥a
                        </button>
                    </div>
                </div>
            `;
        }

        // Reactions Management
        function toggleReaction(id, type) {
            const key = `reaction_${id}_${type}`;
            const currentCount = parseInt(localStorage.getItem(key) || '0');
            const userKey = `user_reaction_${id}_${type}`;
            const hasReacted = localStorage.getItem(userKey);

            const btn = event.target.closest('.reaction-btn');
            
            if (hasReacted) {
                localStorage.setItem(key, Math.max(0, currentCount - 1).toString());
                localStorage.removeItem(userKey);
                btn.classList.remove('active');
            } else {
                localStorage.setItem(key, (currentCount + 1).toString());
                localStorage.setItem(userKey, 'true');
                btn.classList.add('active');
            }

            document.getElementById(`${type}-${id}`).textContent = localStorage.getItem(key);
        }

        function loadReactions(id) {
            ['heart', 'like', 'star', 'smile'].forEach(type => {
                const count = localStorage.getItem(`reaction_${id}_${type}`) || '0';
                const element = document.getElementById(`${type}-${id}`);
                if (element) {
                    element.textContent = count;
                }

                const userKey = `user_reaction_${id}_${type}`;
                if (localStorage.getItem(userKey)) {
                    const buttons = document.querySelectorAll('.reaction-btn');
                    buttons.forEach(btn => {
                        if (btn.textContent.includes(type === 'heart' ? '‚ù§Ô∏è' : type === 'like' ? 'üëç' : type === 'star' ? '‚≠ê' : 'üòä')) {
                            btn.classList.add('active');
                        }
                    });
                }
            });
        }

        // Comments Management
        function toggleComments(id) {
            const commentsList = document.getElementById(`comments-${id}`);
            const isVisible = commentsList.style.display !== 'none';
            commentsList.style.display = isVisible ? 'none' : 'block';
            event.target.textContent = isVisible ? 'Xem b√¨nh lu·∫≠n' : '·∫®n b√¨nh lu·∫≠n';
            
            if (!isVisible) {
                loadComments(id);
            }
        }

        function addComment(id) {
            const input = document.getElementById(`comment-input-${id}`);
            const text = input.value.trim();
            
            if (!text) {
                showToast('Vui l√≤ng nh·∫≠p b√¨nh lu·∫≠n!', 'error');
                return;
            }

            const userName = localStorage.getItem('userName') || '·∫®n danh';
            const comments = JSON.parse(localStorage.getItem(`comments_${id}`) || '[]');
            
            comments.push({
                author: userName,
                text: text,
                timestamp: new Date().toISOString()
            });
            
            localStorage.setItem(`comments_${id}`, JSON.stringify(comments));
            input.value = '';
            loadComments(id);
            showToast('ƒê√£ th√™m b√¨nh lu·∫≠n!', 'success');
        }

        function loadComments(id) {
            const commentsList = document.getElementById(`comments-${id}`);
            const comments = JSON.parse(localStorage.getItem(`comments_${id}`) || '[]');
            
            document.getElementById(`comment-count-${id}`).textContent = comments.length;
            
            if (comments.length === 0) {
                commentsList.innerHTML = '<p style="color: var(--text-tertiary); text-align: center; padding: 20px;">Ch∆∞a c√≥ b√¨nh lu·∫≠n n√†o</p>';
                return;
            }
            
            commentsList.innerHTML = comments.map(comment => `
                <div class="comment">
                    <div class="comment-author">${escapeHtml(comment.author)}</div>
                    <div class="comment-text">${escapeHtml(comment.text)}</div>
                </div>
            `).reverse().join('');
        }

        // Social Sharing
        function shareToFacebook() {
            const url = encodeURIComponent(window.location.href);
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank');
        }

        function shareToTwitter() {
            const url = encodeURIComponent(window.location.href);
            const text = encodeURIComponent('H√£y ƒë·ªÉ l·∫°i l∆∞u b√∫t c·ªßa b·∫°n! üíù');
            window.open(`https://twitter.com/intent/tweet?url=${url}&text=${text}`, '_blank');
        }

        // Instagram Story Integration
        let currentInstagramData = null;

        async function shareToInstagram(entryId) {
            const entry = await getMyEntry();
            if (!entry) {
                showToast('Kh√¥ng t√¨m th·∫•y l∆∞u b√∫t!', 'error');
                return;
            }

            currentInstagramData = entry;
            
            const modal = document.getElementById('instagramModal');
            const overlay = document.getElementById('overlay');
            const preview = document.getElementById('instagramPreview');
            
            // Create Instagram Story card
            preview.innerHTML = createInstagramCard(entry.name, entry.message);
            
            // Generate QR code for the card
            setTimeout(() => {
                const qrContainer = document.getElementById('instaQR');
                if (qrContainer) {
                    new QRCode(qrContainer, {
                        text: window.location.href,
                        width: 100,
                        height: 100,
                        colorDark: '#000000',
                        colorLight: '#ffffff',
                    });
                }
            }, 100);
            
            modal.classList.add('show');
            overlay.classList.add('show');
        }

        function createInstagramCard(name, message) {
            // Truncate message if too long
            const maxLength = 200;
            const displayMessage = message.length > maxLength 
                ? message.substring(0, maxLength) + '...' 
                : message;
            
            return `
                <div class="instagram-card" id="instagramCard">
                    <div class="instagram-card-content">
                        <div class="instagram-header">
                            <div class="instagram-title">üíù L∆∞u B√∫t</div>
                            <div class="instagram-subtitle">C·ªßa Khang</div>
                        </div>
                        
                        <div class="instagram-message-box">
                            <div class="instagram-author">${escapeHtml(name)}</div>
                            <div class="instagram-text">${escapeHtml(displayMessage)}</div>
                        </div>
                        
                        <div class="instagram-footer">
                            <div class="instagram-qr" id="instaQR"></div>
                            <div class="instagram-url">Qu√©t ƒë·ªÉ xem to√†n b·ªô</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function closeInstagramModal() {
            document.getElementById('instagramModal').classList.remove('show');
            document.getElementById('overlay').classList.remove('show');
        }

        async function downloadInstagramStory() {
            const card = document.getElementById('instagramCard');
            if (!card) {
                showToast('Kh√¥ng th·ªÉ t·∫°o ·∫£nh!', 'error');
                return;
            }

            try {
                // Use html2canvas library if available
                if (typeof html2canvas !== 'undefined') {
                    const canvas = await html2canvas(card, {
                        scale: 2,
                        backgroundColor: null,
                        logging: false
                    });
                    
                    canvas.toBlob((blob) => {
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `luu-but-${Date.now()}.png`;
                        a.click();
                        URL.revokeObjectURL(url);
                        showToast('ƒê√£ t·∫£i ·∫£nh th√†nh c√¥ng! H√£y chia s·∫ª l√™n Instagram Stories üì∏', 'success');
                    });
                } else {
                    // Fallback: open in new window
                    showToast('Vui l√≤ng ch·ª•p m√†n h√¨nh ƒë·ªÉ chia s·∫ª l√™n Instagram!', 'info');
                    
                    // Open Instagram app if on mobile
                    if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
                        window.open('instagram://story-camera', '_blank');
                    }
                }
            } catch (error) {
                console.error('Download error:', error);
                showToast('Vui l√≤ng ch·ª•p m√†n h√¨nh th·ªß c√¥ng ƒë·ªÉ chia s·∫ª!', 'info');
            }
        }

        // QR Code
        function showQRModal() {
            const modal = document.getElementById('qrModal');
            const overlay = document.getElementById('overlay');
            const qrContainer = document.getElementById('qrcode');
            
            // Clear previous QR code
            qrContainer.innerHTML = '';
            
            // Generate new QR code
            new QRCode(qrContainer, {
                text: window.location.href,
                width: 200,
                height: 200,
                colorDark: '#0a0a0a',
                colorLight: '#ffffff',
            });
            
            modal.classList.add('show');
            overlay.classList.add('show');
        }

        function closeQRModal() {
            document.getElementById('qrModal').classList.remove('show');
            document.getElementById('overlay').classList.remove('show');
        }

        // Show read page
        function showReadPage() {
            const entryData = localStorage.getItem('myEntry');
            
            if (!entryData) {
                showToast('B·∫°n ch∆∞a vi·∫øt l∆∞u b√∫t n√†o. H√£y b·∫Øt ƒë·∫ßu vi·∫øt nh√©!', 'info');
                return;
            }
            
            showPage('read');
            loadMyLetter();
        }

        // Load my letter
        function loadMyLetter() {
            const container = document.getElementById('myLetterContainer');
            const entryData = localStorage.getItem('myEntry');
            
            showSkeletonLoading(container);
            
            setTimeout(() => {
                if (!entryData) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 80px 20px;">
                            <div style="font-size: 5em; margin-bottom: 30px; opacity: 0.2;">üì≠</div>
                            <p style="font-size: 1.2em; color: var(--text-secondary); margin-bottom: 40px;">
                                B·∫°n ch∆∞a vi·∫øt l∆∞u b√∫t n√†o
                            </p>
                            <button class="btn btn-primary" onclick="showPage('write')">‚úçÔ∏è Vi·∫øt l∆∞u b√∫t ngay</button>
                        </div>
                    `;
                    return;
                }

                try {
                    const entry = JSON.parse(entryData);
                    const id = entry.id || 'my-letter';
                    
                    localStorage.setItem('userName', entry.name);
                    
                    container.innerHTML = createLetterCard(entry.name, entry.message, entry.date, id);
                    
                    loadReactions(id);
                    loadComments(id);
                } catch (error) {
                    console.error('Error loading letter:', error);
                    container.innerHTML = `
                        <div style="text-align: center; padding: 80px 20px;">
                            <div style="font-size: 5em; margin-bottom: 30px;">‚ö†Ô∏è</div>
                            <p style="font-size: 1.2em; color: var(--text-secondary); margin-bottom: 40px;">
                                C√≥ l·ªói khi t·∫£i l∆∞u b√∫t
                            </p>
                            <button class="btn btn-primary" onclick="showPage('home')">üè† Quay l·∫°i</button>
                        </div>
                    `;
                }
            }, 800);
        }

        // Edit letter
        function editLetter() {
            const entryData = localStorage.getItem('myEntry');
            if (!entryData) return;

            try {
                const entry = JSON.parse(entryData);
                document.getElementById('name').value = entry.name === '·∫®n danh' ? '' : entry.name;
                document.getElementById('message').value = entry.message;
                updateCharCount();
                showPage('write');
                showToast('B·∫°n c√≥ th·ªÉ ch·ªânh s·ª≠a l∆∞u b√∫t c·ªßa m√¨nh', 'info');
            } catch (error) {
                console.error('Error editing letter:', error);
                showToast('C√≥ l·ªói x·∫£y ra khi ch·ªânh s·ª≠a', 'error');
            }
        }

        // Delete letter
        function deleteLetter() {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a l∆∞u b√∫t n√†y kh√¥ng? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.')) {
                localStorage.removeItem('myEntry');
                showToast('ƒê√£ x√≥a l∆∞u b√∫t c·ªßa b·∫°n', 'success');
                showPage('home');
            }
        }

        // Escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Open playlist
        function openPlaylist() {
            const playlistUrl = 'https://open.spotify.com/playlist/37i9dQZF1DX3rxVfibe1L0';
            window.open(playlistUrl, '_blank', 'noopener,noreferrer');
        }

        // Handle submit
        async function handleSubmit() {
            const name = document.getElementById('name').value.trim() || '·∫®n danh';
            const message = document.getElementById('message').value.trim();
            const date = document.getElementById('date').value;

            if (!message) {
                showToast('Vui l√≤ng nh·∫≠p l·ªùi nh·∫Øn!', 'error');
                return;
            }

            const submitBtn = document.getElementById('confirmSubmitBtn');
            const originalText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="loading-spinner"></span> ƒêang g·ª≠i...';

            try {
                const entry = {
                    name: name,
                    message: message,
                    date: date,
                    id: Date.now(),
                    timestamp: new Date().toISOString()
                };

                // Save to localStorage
                localStorage.setItem('myEntry', JSON.stringify(entry));
                localStorage.setItem('userName', name);

                // Send email if configured
                if (emailJSConfigured) {
                    try {
                        await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, {
                            from_name: name,
                            message: message,
                            date: date
                        });
                    } catch (emailError) {
                        console.error('Email error:', emailError);
                    }
                }

                // Clear form
                document.getElementById('name').value = '';
                document.getElementById('message').value = '';
                updateCharCount();

                // Trigger confetti
                triggerConfetti();

                // Show success page
                setTimeout(() => {
                    showPage('thankYou');
                    showToast('L∆∞u b√∫t c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c g·ª≠i th√†nh c√¥ng!', 'success');
                }, 500);

            } catch (error) {
                console.error('Submit error:', error);
                showToast('C√≥ l·ªói x·∫£y ra, vui l√≤ng th·ª≠ l·∫°i', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        }

        // Modal handlers
        document.getElementById('overlay').addEventListener('click', function() {
            closeQRModal();
            closeInstagramModal();
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeQRModal();
                closeInstagramModal();
            }
        });

        // Handle comment input enter key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.target.classList.contains('comment-input')) {
                const id = e.target.id.replace('comment-input-', '');
                addComment(id);
            }
        });
    </script>
</body>
</html>